{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-end flex-wrap gap-2 mb-3">
    <div>
      <h4 class="mb-1">{{ league|upper }} Player Stats ({{ season }})</h4>
      <small class="text-muted">Source: Baseball-Reference (WAR by League)</small>
    </div>

    <form method="get" class="d-flex align-items-center gap-2">
      <input type="hidden" name="season" value="{{ season }}">
      <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Player search" style="max-width:200px">

      <select name="team" class="form-select" style="max-width:120px">
        <option value="">All Teams</option>
        {% for t in teams %}
          <option value="{{ t }}" {% if team == t %}selected{% endif %}>{{ t }}</option>
        {% endfor %}
      </select>

      <select name="order" class="form-select" style="max-width:140px">
        {% for key in order_options %}
          <option value="{{ key }}" {% if order == key %}selected{% endif %}>Sort: {{ key }}</option>
        {% endfor %}
      </select>     

      <button class="btn btn-primary">Apply</button>
    </form>
  </div>

  <div class="table-responsive">
    <table class="table table-sm table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Rank</th>
          <th>Player</th>
          <th>Age</th>
          <th>Team</th>
          <th>Lg</th>
          <th>WAR</th>
          <th>G</th>
          <th>PA</th>
          <th>AB</th>
          <th>R</th>
          <th>H</th>
          <th>2B</th>
          <th>3B</th>
          <th>HR</th>
          <th>RBI</th>
          <th>SB</th>
          <th>BB</th>
          <th>SO</th>
          <th>BA</th>
          <th>OBP</th>
          <th>SLG</th>
          <th>OPS</th>
          <th>OPS+</th>
          <th>rOBA</th>
          <th>Rbat+</th>
          <th>TB</th>
          <th>GIDP</th>
          <th>HBP</th>
          <th>SH</th>
          <th>SF</th>
          <th>IBB</th>
          <th>Pos</th>
          <th>Awards</th>
        </tr>
      </thead>
      <tbody>
        {% for p in page_obj %}
          <tr>
            <td>{{ p.rank }}</td>
            <td>{{ p.player }}</td>
            <td>{{ p.age }}</td>
            <td>{{ p.team_norm }}</td>
            <td>{{ p.lg }}</td>
            <td>{{ p.WAR }}</td>
            <td>{{ p.G }}</td>
            <td>{{ p.PA }}</td>
            <td>{{ p.AB }}</td>
            <td>{{ p.R }}</td>
            <td>{{ p.H }}</td>
            <td>{{ p.2B }}</td>
            <td>{{ p.3B }}</td>
            <td>{{ p.HR }}</td>
            <td>{{ p.RBI }}</td>
            <td>{{ p.SB }}</td>
            <td>{{ p.BB }}</td>
            <td>{{ p.SO }}</td>
            <td>{{ p.BA }}</td>
            <td>{{ p.OBP }}</td>
            <td>{{ p.SLG }}</td>
            <td>{{ p.OPS }}</td>
            <td>{{ p.OPS_plus }}</td>
            <td>{{ p.rOBA }}</td>
            <td>{{ p.Rbat_plus }}</td>
            <td>{{ p.TB }}</td>
            <td>{{ p.GIDP }}</td>
            <td>{{ p.HBP }}</td>
            <td>{{ p.SH }}</td>
            <td>{{ p.SF }}</td>
            <td>{{ p.IBB }}</td>
            <td>{{ p.Pos }}</td>
            <td>{{ p.Awards }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="33" class="text-center text-muted">No data.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
    <nav class="mt-3">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?season={{ season }}&q={{ q }}&team={{ team }}&order={{ order }}&page={{ page_obj.previous_page_number }}">Prev</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Prev</span></li>
        {% endif %}

        <li class="page-item disabled"><span class="page-link">
          Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
        </span></li>

        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?season={{ season }}&q={{ q }}&team={{ team }}&order={{ order }}&page={{ page_obj.next_page_number }}">Next</a></li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}
