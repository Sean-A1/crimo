{% extends 'base.html' %}
{% load static %}
{% load static_league %}

{% block content %}
<div class="container my-4">

    <!-- 월 선택 바 -->
    <div class="text-center mb-4">
        <button class="btn btn-light rounded-circle" id="prevMonth">&lt;</button>
        <strong class="mx-3" style="font-size: 1.5rem;">{{ year_month }}</strong>
        <button class="btn btn-light rounded-circle" id="nextMonth">&gt;</button>
    </div>

    <!-- 날짜 선택 바 -->
    <div class="d-flex justify-content-center align-items-center mb-3">
        {% if prev_chunk_date %}
            <a href="?date={{ prev_chunk_date }}" class="btn btn-light rounded-circle">&lt;</a>
        {% else %}
            <button class="btn btn-light rounded-circle" disabled>&lt;</button>
        {% endif %}

        <div class="overflow-auto mx-3">
            <div class="d-flex justify-content-center">

                {% for date in date_range %}
                    {% with date_str=date|date:"m/d" %}
                        {% if date_str in available_dates %}
                            <!-- ✅ 경기 일정이 있는 날짜 (클릭 가능) -->
                            <div class="date-item px-3 py-2 mx-2 {% if date_str == selected_date %}bg-primary text-white{% endif %}"
                                style="cursor:pointer;" data-date="{{ date_str }}">
                                <div>{{ date|date:"d" }}</div>
                            </div>
                        {% else %}
                            <!-- ❌ 경기 일정이 없는 날짜 (비활성화) -->
                            <div class="date-item px-3 py-2 mx-2 text-muted"
                                style="cursor:not-allowed; opacity: 0.5;">
                                <div>{{ date|date:"d" }}</div>
                            </div>
                        {% endif %}
                    {% endwith %}
                {% endfor %}

            </div>
        </div>

        {% if next_chunk_date %}
            <a href="?date={{ next_chunk_date }}" class="btn btn-light rounded-circle">&gt;</a>
        {% else %}
            <button class="btn btn-light rounded-circle" disabled>&gt;</button>
        {% endif %}
    </div>

    <!-- 경기 일정 -->
    <div class="card shadow-sm rounded">
        <div class="card-body">
            <table class="table table-striped text-center">
                <thead>
                    <tr>
                        
                        <th>Time</th>
                        <th>Stadium</th>
                        <th></th>
                        <th>Home</th>
                        <th></th>
                        
                        <th>Away</th>
                        
                    </tr>
                </thead>
                <tbody>
                    {% for game in schedules %}
                    <tr>
                        <td>{{ game.time }}</td>
                        <td>{{ game.stadium }}</td>

                        <td class="text-end">
                            <strong>{{ game.team1 }}</strong>
                            <img src="{% static_team_logo game.team1 league %}" style="width:35px;">
                            
                        </td>

                        <td>
                            {% if game.score_team1 != -1 %}
                                <strong>{{ game.score_team1 }}</strong>
                            {% else %}
                                <strong></strong>
                            {% endif %}

                        </td>
                        
                        <td>vs</td>

                        <td>
                            {% if game.score_team2 != -1 %}
                                <strong>{{ game.score_team2 }}</strong>
                            {% else %}
                                <strong></strong>
                            {% endif %}

                        </td>
                        
                        <td class="text-start">
                            <img src="{% static_team_logo game.team2 league %}" style="width:35px;">
                            <strong>{{ game.team2 }}</strong>
                        </td>
                        

                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">경기 일정이 없습니다.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){
    // 날짜 클릭
    document.querySelectorAll('.date-item').forEach(item => {
        item.addEventListener('click', function(){
            window.location.href = '?date=' + item.dataset.date;
        });
    });

    // 이전달 버튼 클릭
    document.getElementById('prevMonth').addEventListener('click', function(){
        const currentMonth = "{{ year_month }}".split('.');
        let year = parseInt(currentMonth[0]);
        let month = parseInt(currentMonth[1]) - 1;

        if(month === 0){
            month = 12;
            year -= 1;
        }

        window.location.href = `?date=${month}/01`;
    });

    // 다음달 버튼 클릭
    document.getElementById('nextMonth').addEventListener('click', function(){
        const currentMonth = "{{ year_month }}".split('.');
        let year = parseInt(currentMonth[0]);
        let month = parseInt(currentMonth[1]) + 1;

        if(month === 13){
            month = 1;
            year += 1;
        }

        window.location.href = `?date=${month}/01`;
    });
});
</script>

{% endblock %}
