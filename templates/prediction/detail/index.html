{% extends 'base.html' %}
{% load static %}
{% load static_league %}

{% block content %}


<!-- ê·¸ë˜í”„ -->
<!-- Prediction ì•± ì „ìš© CSS -->
<link rel="stylesheet" href="{% static 'prediction/style.css' %}">

<div class="container my-4">

    <!-- ì œëª© -->
    <h2 class="mb-4">{{ schedule.team1 }} vs {{ schedule.team2 }} ìƒì„¸ ì˜ˆì¸¡ì •ë³´</h2>

    <!-- ì—°ë…¸ë‘ìƒ‰ ì—…ë°ì´íŠ¸ í˜„í™© ë°•ìŠ¤ -->
    <div class="alert alert-warning">
        ğŸ“Œ ì—…ë°ì´íŠ¸ í˜„í™©: 2025ë…„ {{ schedule.month }}ì›” {{ schedule.date }}ì¼ ì˜ˆì¸¡ ë°ì´í„° ì—…ë°ì´íŠ¸
    </div>

    <!-- ì—°ì´ˆë¡ìƒ‰ ìƒì„¸ ì •ë³´ ë°•ìŠ¤ -->
    <div class="alert alert-success">
        ğŸ“‹ <strong>ìƒì„¸ ì •ë³´</strong><br>
        ğŸ”¹ ë‚ ì§œ: {{ schedule.month }}/{{ schedule.date }}<br>
        ğŸ”¹ ê²½ê¸°ì¥: {{ schedule.stadium }}<br>
        ğŸ”¹ ìŠ¹ë¥  ì˜ˆì¸¡: {{ schedule.team1 }}({{ schedule.win_prob_team1 }}%) vs {{ schedule.team2 }}({{ schedule.win_prob_team2 }}%)<br>
    </div>

    <!-- ê·¸ë˜í”„ ì„¹ì…˜ -->
    <div class="card mt-4">

        <!-- ë“ì  -->
        <div class="card-header bg-light">
            ğŸ“Š ë“ì  ì‹œë‚˜ë¦¬ì˜¤
        </div>

        <div class="card-body">
            <canvas id="scoreChart"></canvas>
        </div>

        <!-- ì´ ë“ì  -->
        <div class="card-header bg-light">
            ğŸ“Š ì´ ë“ì  ì‹œë‚˜ë¦¬ì˜¤
        </div>

        <div class="card-body">
            <canvas id="cumulativeChart"></canvas>
        </div>

    </div>
</div>


<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const inning_labels = ['1íšŒ', '2íšŒ', '3íšŒ', '4íšŒ', '5íšŒ', '6íšŒ', '7íšŒ', '8íšŒ', '9íšŒ'];
    const scenario_team1 = {{ scenario_team1|safe }};
    const scenario_team2 = {{ scenario_team2|safe }};

    // âœ” ì´ ë“ì  ëˆ„ì  ë°ì´í„° ìƒì„±
    const cumulativeTeam1 = scenario_team1.reduce((acc, cur, idx) => {
        acc.push((acc[idx - 1] || 0) + cur);
        return acc;
    }, []);

    const cumulativeTeam2 = scenario_team2.reduce((acc, cur, idx) => {
        acc.push((acc[idx - 1] || 0) + cur);
        return acc;
    }, []);

    // âœ” ë“ì  ì‹œë‚˜ë¦¬ì˜¤ ì°¨íŠ¸ (ì •ìˆ˜ë§Œ)
    const scoreCtx = document.getElementById('scoreChart').getContext('2d');
    new Chart(scoreCtx, {
        type: 'line',
        data: {
            labels: inning_labels,
            datasets: [
                {
                    label: '{{ schedule.team1 }} ë“ì  ì‹œë‚˜ë¦¬ì˜¤',
                    data: scenario_team1,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 2,
                },
                {
                    label: '{{ schedule.team2 }} ë“ì  ì‹œë‚˜ë¦¬ì˜¤',
                    data: scenario_team2,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: { 
                    beginAtZero: true,
                    ticks: { stepSize: 1 }  // âœ… ì •ìˆ˜ë§Œ í‘œì‹œ
                }
            }
        }
    });

    // âœ” ì´ ë“ì  ì‹œë‚˜ë¦¬ì˜¤ ì°¨íŠ¸
    const cumulativeCtx = document.getElementById('cumulativeChart').getContext('2d');
    new Chart(cumulativeCtx, {
        type: 'line',
        data: {
            labels: inning_labels,
            datasets: [
                {
                    label: '{{ schedule.team1 }} ì´ ë“ì ',
                    data: cumulativeTeam1,
                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 2,
                },
                {
                    label: '{{ schedule.team2 }} ì´ ë“ì ',
                    data: cumulativeTeam2,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 2,
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: { 
                    beginAtZero: true,
                    ticks: { stepSize: 1 }  // âœ… ì •ìˆ˜ë§Œ í‘œì‹œ
                }
            }
        }
    });
</script>

{% endblock %}