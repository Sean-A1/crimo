{% extends 'base.html' %}
{% load static %}
{% load static_league %}

{% block content %}
<!-- Bootstrap 아이콘 적용 
<a href="?date={{ prev_week }}" class="btn btn-outline-secondary">
    <i class="bi bi-chevron-left"></i>
</a>
-->

<!-- Bootstrap Icons CDN 추가 (base.html에 있다면 생략) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">


<div class="container my-4">

    <!-- 날짜 선택 UI -->
    <div class="d-flex justify-content-center align-items-center my-3">
        <a href="?date={{ prev_week }}" class="btn btn-light">
            <i class="bi bi-chevron-left"></i>
        </a>

        <span class="mx-3 fs-5 fw-bold">{{ week_range }}</span>

        <a href="?date={{ next_week }}" class="btn btn-light">
            <i class="bi bi-chevron-right"></i>
        </a>

        <input type="date" class="form-control ms-3" style="width:auto;" id="datePicker">
    </div>

    {% for date, games in schedule_by_date.items %}
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
            <h5>{{ date }}</h5>
        </div>
        <div class="card-body">
            {% for game in games %}
            <div class="row mb-3 align-items-center">
                <!-- 이미지 클릭 시 링크 -->
                <div class="col-md-4">
                    <a href="{% url 'prediction:pred_detail' league game.month game.date game.team1 game.team2 %}">
                        {% with "2025"|add:game.month|stringformat:"02d"|add:game.date|stringformat:"02d" as date_str %}
                        
                            <!--
                            <img src="{% static_prediction_image date_str game.team1 game.team2 league %}"
                                 class="img-fluid rounded">
                                 -->

                            <img src="{% static 'images/prediction/' %}{{ forloop.counter|add:'-1'|divisibleby:3|yesno:'3,2,1' }}.png"
                            class="img-fluid rounded">
                            
                        {% endwith %}
                    </a>
                </div>

                <!-- 제목 클릭 시 링크 -->
                <div class="col-md-8">
                    <a href="{% url 'prediction:pred_detail' league game.month game.date game.team1 game.team2 %}" class="text-decoration-none text-dark">
                        <h6>
                            {{game.team1}} ({{ game.win_prob_team1 }}%) vs {{game.team2}} ({{ game.win_prob_team2 }}%)<br>
                            Game Prediction by Percentage - {{game.month}}/{{game.date}} <br>
                            {{ league|upper }} Regular Season
                        </h6>
                    </a>               
                </div>
            </div>
            <hr>
            {% endfor %}
        </div>
    </div>
    {% empty %}
    <p>경기 일정이 없습니다.</p>
    {% endfor %}
</div>

<!-- script -->
<script>
    document.getElementById('datePicker').addEventListener('change', function() {
        const selectedDate = new Date(this.value);
        const month = selectedDate.getMonth() + 1;
        const day = selectedDate.getDate();
        window.location.href = `?date=${month}/${day}`;
    });
</script>

<style>
    input[type="date"]::-webkit-datetime-edit {
        display: none;
    }
    
    input[type="date"] {
        width: 40px;
        padding: 5px;
    }
</style>
    

{% endblock %}
